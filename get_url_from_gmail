import java.net.URLEncoder;
import java.util.Properties;

import com.google.code.com.sun.mail.imap.IMAPFolder;
import com.google.code.com.sun.mail.imap.IMAPMessage;
import com.google.code.com.sun.mail.imap.IMAPSSLStore;
import com.google.code.javax.mail.FetchProfile;
import com.google.code.javax.mail.Folder;
import com.google.code.javax.mail.Message;
import com.google.code.javax.mail.Session;

public class GetGmailURL {

 private static String email = "email@gmail.com";
 private static String password = "password";
 private static int msg_num = 10;
 private static String host = "imap.gmail.com";

 public static void main(String[] args) throws MessagingException {
  Properties props = new Properties();
  props.setProperty("mail.store.protocol", "imaps");
  Session session = Session.getDefaultInstance(props, null);
  IMAPSSLStore store = new IMAPSSLStore(session, null);
  Folder inbox = null;
  try {
   store.connect(host, email, password);
   inbox = store.getFolder("Inbox");
   inbox.open(Folder.READ_ONLY);
   int count = inbox.getMessageCount();
   Message messages[] = inbox.getMessages(count-msg_num, count);
   FetchProfile fp = new FetchProfile();
   fp.add(IMAPFolder.FetchProfileItem.X_GM_MSGID);
   fp.add(IMAPFolder.FetchProfileItem.X_GM_THRID);
   fp.add(IMAPFolder.FetchProfileItem.X_GM_LABELS);
   inbox.fetch(messages, fp);

   for(int i=msg_num; i>0; i--){
    System.out.println("Title: " + messages[i].getSubject());
    IMAPMessage im = (IMAPMessage) messages[i];
    String msgId = Long.toHexString(im.getGoogleMessageId());
    String url = "https://mail.google.com/mail/u/0/?shva=1#inbox/" + msgId;
    System.out.println("URL: "url);
    String[] labels = im.getGoogleMessageLabels();
    if(labels!=null){
     for(String label: labels){
      System.out.println("Label: " + label);
     }
    }
    System.out.println();
   }
  } catch (Exception e) {
   e.printStackTrace();
  } finally {
   if(inbox.isOpen()) {
    inbox.close(true);
   }
   if(store.isConnected()){
    store.close();
   }
  }
 }
}
